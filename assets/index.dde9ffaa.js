(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerpolicy&&(r.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?r.credentials="include":t.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();let c=null;const F=()=>new Promise((e,o)=>{let s=indexedDB.open("booksDb",1);s.onerror=function(n){o(n)},s.onupgradeneeded=()=>{c=s.result,c.createObjectStore("books",{keyPath:"name"});const n=s.result.transaction;n.oncomplete=()=>{e(!0)}},s.onsuccess=()=>{c=s.result,e(!0)}}),I=e=>new Promise((o,s)=>{const r=c.transaction("books","readwrite").objectStore("books").add(e);r.onsuccess=()=>{o()},r.onerror=()=>{r.error.name=="ConstraintError"&&s("\u0422\u0430\u043A\u0430\u044F \u043A\u043D\u0438\u0433\u0430 \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442")}}),T=async e=>{const n=c.transaction("books","readwrite").objectStore("books").delete(e);n.onerror=()=>{n.error&&alert("\u0423\u043F\u0441! \u0427\u0442\u043E - \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043A\u043D\u0438\u0433\u0430 \u043D\u0435 \u0443\u0434\u0430\u043B\u0438\u043B\u0430\u0441\u044C \u0432 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435")}},B=async e=>{const n=c.transaction("books","readwrite").objectStore("books").put(e);n.onerror=()=>{n.error&&alert("\u0423\u043F\u0441! \u0427\u0442\u043E - \u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A, \u043A\u043D\u0438\u0433\u0430 \u043D\u0435 \u043E\u0442\u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435")}},O=()=>new Promise((e,o)=>{const t=c.transaction("books").objectStore("books").getAll();t.onsuccess=()=>{e(t.result)},t.onerror=()=>{o(t.error)}}),m=document.querySelector(".popup-overlay"),g=document.getElementById("edit-header"),E=document.getElementById("edit-text"),P=document.getElementById("edit-submit");let S=null,u=null;const M=(e,o)=>{m.classList.add("visible"),g.value=e.name,E.value=e.text,S=o,u=e};P.onclick=()=>{m.classList.remove("visible"),S.querySelector("h4").innerText=g.value;const e={...u};if(g.value===""||E.value===""){alert("\u0414\u043B\u044F \u043D\u0430\u0447\u0430\u043B\u0430 \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A \u0438 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043A\u043D\u0438\u0433\u0438");return}u.name=g.value,u.text=E.value,T(e.name),I(u),document.getElementById("show-title").innerText="",document.getElementById("show-window").innerText=""};m.onclick=e=>{e.target===m&&m.classList.remove("visible")};const b="\u041F\u0420\u041E\u0427\u0418\u0422\u0410\u041B",x="\u041F\u0420\u041E\u0427\u0418\u0422\u0410\u041D\u0410";let f=null,l=null;const D=e=>{const o=document.createElement("li"),s=document.createElement("h4"),n=document.createElement("button"),t=document.createElement("button"),r=document.createElement("button"),a=document.createElement("button");s.innerText=e.name,n.innerText="\u0420\u0435\u0434.",t.innerText=e.isRead?b:x,t.style.opacity=e.isRead?".5":"1",r.innerText="\u0427\u0438\u0442\u0430\u0442\u044C",a.innerText="X",o.append(s),o.append(n),o.append(t),o.append(r),o.append(a),t.onclick=()=>{const i=e.isRead;B({...e,isRead:!i}),t.innerText===b?(t.innerHTML=x,t.style.opacity="1"):(t.innerHTML=b,t.style.opacity=".5")},r.onclick=()=>{document.getElementById("show-title").innerText=e.name,document.getElementById("show-window").innerText=e.text},n.onclick=()=>M(e,o),a.onclick=()=>{T(e.name),o.remove()},e.isFavorite?h.append(o):w.append(o),o.draggable=!0,o.ondragstart=i=>{f=o,l=e}},R=e=>{e.preventDefault(),e.target.classList.add("dragover")},q=e=>{e.preventDefault(),e.target.classList.remove("dragover")},v=document.getElementById("favorite-droppable");v.ondragover=R;v.ondragleave=q;v.ondrop=e=>{e.preventDefault(),v.classList.remove("dragover"),l.isFavorite||(h.append(f),l.isFavorite=!0,B(l)),f=null,l=null};const y=document.getElementById("books-list-droppable");y.ondragover=R;y.ondragleave=q;y.ondrop=e=>{e.preventDefault(),y.classList.remove("dragover"),l.isFavorite&&(w.append(f),l.isFavorite=!1,B(l)),f=null,l=null};const j=e=>{const o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@*_+-./,";e=e.toString();for(var s=e.length,n="",t=0,r,a,i;t<s;)a=e[t],o.indexOf(a)!=-1?r=a:(i=e.charCodeAt(t),i<256?r="%"+("00"+i.toString(16)).toUpperCase().slice(-2):r="%u"+("0000"+i.toString(16)).toUpperCase().slice(-4)),n+=r,t++;return decodeURIComponent(n)},C=()=>"login-"+Math.floor(Math.random()*Date.now()),H=e=>{e.sort((n,t)=>n.date-t.date);const o=[],s=[];e.forEach(n=>{n.isRead?s.push(n):o.push(n)}),e=o.concat(s),e.forEach(n=>{D(n)})},N=document.getElementById("download"),A=document.getElementById("write"),d=document.getElementById("book-form"),k=document.getElementById("titleInput"),L=document.getElementById("descriptionTitle"),p=document.getElementById("file"),w=document.getElementById("books-list"),h=document.getElementById("books-favourite");localStorage.getItem("lib-login")||localStorage.setItem("lib-login",C());const U=async()=>{try{if(h.innerHTML="",w.innerHTML="",await F()){const o=await O();H(o)}}catch{alert("\u041D\u0435 \u043F\u043E\u043B\u0443\u0447\u0438\u043B\u043E\u0441\u044C \u043F\u043E\u043B\u0443\u0447\u0438\u0442\u044C \u0432\u0441\u0435 \u043A\u043D\u0438\u0433\u0438, \u043F\u043E\u043F\u0440\u043E\u0431\u0443\u0439\u0442\u0435 \u043F\u043E\u0437\u0436\u0435")}};U();N.addEventListener("change",()=>{d.classList.add("download"),d.classList.remove("write")});A.addEventListener("change",()=>{d.classList.add("write"),d.classList.remove("download")});p.addEventListener("change",()=>{p.nextElementSibling.innerText=p.files[0].name});d.addEventListener("submit",async e=>{try{e.preventDefault();const o=new FormData;if(o.append("login",localStorage.getItem("lib-login")),d.classList.contains("write")){if(L.value===""||k.value===""){alert("\u0414\u043B\u044F \u043D\u0430\u0447\u0430\u043B\u0430 \u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A \u0438 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043A\u043D\u0438\u0433\u0438");return}const r=new File([L.value],k.value,{type:"text/plain"});o.append("file",r)}else{if(!p.files[0]){alert("\u0412\u044B \u043D\u0435 \u043F\u0440\u0438\u043A\u0440\u0435\u043F\u0438\u043B\u0438 \u0444\u0430\u0439\u043B");return}o.append("file",p.files[0])}let n=await(await fetch("https://apiinterns.osora.ru/",{method:"POST",body:o})).json();const t={name:n.title.replace(/\.[^/.]+$/,""),text:j(n.text),isRead:!1,isFavorite:!1,date:new Date};await I(t),D(t)}catch(o){alert(o)}});
